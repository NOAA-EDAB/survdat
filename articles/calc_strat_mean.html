<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Calculating stratified mean biomass/abundance • survdat</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculating stratified mean biomass/abundance">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">survdat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/survdat.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Introduction</h6></li>
    <li><a class="dropdown-item" href="../articles/surveyDesign.html">Survey design</a></li>
    <li><a class="dropdown-item" href="../articles/pullingData.html">Pulling the data</a></li>
    <li><a class="dropdown-item" href="../articles/lookupTables.html">Lookup tables</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Methodology</h6></li>
    <li><a class="dropdown-item" href="../articles/methodology.html">Estimating Biomass</a></li>
    <li><a class="dropdown-item" href="../articles/calc_strat_mean.html">Estimating stratified mean</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NOAA-EDAB/survdat/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calculating stratified mean biomass/abundance</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/NOAA-EDAB/survdat/blob/master/vignettes/calc_strat_mean.Rmd" class="external-link"><code>vignettes/calc_strat_mean.Rmd</code></a></small>
      <div class="d-none name"><code>calc_strat_mean.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>The <code>survdat</code> package is designed to work with the
Northeast Fisheries Science Center’s (NEFSC) bottom trawl surveys. The
NEFSC has been conducting standardized bottom trawl surveys in the fall
since 1963 and spring since 1968. The surveys follow a stratified random
design. Fish species and several invertebrate species are enumerated on
a tow by tow basis <span class="citation">[@Azarovitz_1981]</span>. The
data are housed in the NEFSC’s survey database (SVDBS) maintained by the
Ecosystem Survey Branch.</p>
<p>The <code>get_survdat_data</code> function will query the NEFSC
survey database (SVSDBS) and apply the appropriate calibration factors
associated with gear or vessel differences throughout the time series.
However, end users are usually interested in more derived estimates of
biomass or abundance that the tow by tow data retrieved via
<code>get_survdat_data</code>. The stratified random design of the
survey allows for the calculation of a stratified mean biomass or
abundance for a species or group of species.</p>
<p>To facilitate the calculation of these stratified means, the
<code>survdat</code> package has the function
<code>calc_stratified_mean</code>. This function is actually a wrapper
of several intermediate functions.</p>
<div class="figure">
<img src="calc_strat_mean_files/figure-html/functions-1.png" alt="Work flow of the `calc_stratified_mean` function with associated intermediate functions." width="576"><p class="caption">
Work flow of the <code>calc_stratified_mean</code> function with
associated intermediate functions.
</p>
</div>
</div>
<div class="section level2">
<h2 id="strat_prep">
<code>strat_prep</code><a class="anchor" aria-label="anchor" href="#strat_prep"></a>
</h2>
<p>The first function called is <code>strat_prep</code>. As the name
implies, <code>strat_prep</code> prepares the data set so that the
stratified means can be calculated. Nested within this function are the
<code>post_strat</code> and <code>get_area</code> functions. The
<code>post_strat</code> function is used if not following the stratified
design of the survey. It is automatically called if the user inputs an
<code>sf</code> object rather than the specified default <em>‘NEFSC
strata’</em>. When this occurs, the R object <code>poststratData</code>
generated by <code>post_strat</code> will replace the
<code>survdat</code> data object and is ultimately passed through to the
<code>prepData</code> object. This will also turn on the
<code>poststratFlag</code> which is used by the <code>strat_mean</code>
function.</p>
<p>At this point you can also filter the data using the
<code>filterBySeason</code> or <code>filterByArea</code> arguments. The
first will allow you to select one of three options: <em>‘FALL’</em>,
<em>‘SPRING’</em>, or <em>‘all’</em>. The default option is
<em>‘all’</em>. Note that selecting both the spring and fall survey will
combine the two surveys. So if you want to have separate means for both
surveys you need to run them independently. The second filter will allow
you to select a subset of strata to use in your analysis.</p>
<p>The rest of the prep work done by <code>strat_prep</code> is counting
the number of tows per strata and the proportional weight of the strata.
This adds the columns <code>ntows</code> and <code>W.h</code> to the
data set. The number of tows (<code>ntows</code>) is simply the length
of unique station records per stratum:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Count the number of stations in each year for each Region</span></span>
<span>  <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setkey.html" class="external-link">setkey</a></span><span class="op">(</span><span class="va">stations</span>, <span class="va">YEAR</span>, <span class="va">STRAT</span><span class="op">)</span></span>
<span>  <span class="va">stations</span><span class="op">[</span>, <span class="va">ntows</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">STATION</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu">key</span><span class="op">(</span><span class="va">stations</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>Proportional weights of the strata are based on their area. The area
of the strata are calculated using the <code>get_area</code> function
which uses a Lambert Conformal Conic projection. The
<code>get_area</code> function creates a list of strata and their
corresponding areas (A) which <code>strat_prep</code> uses to calculate
the relative weight (W) of each strata h as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>W</mi><mi>h</mi></msub><mo>=</mo><mfrac><msub><mi>A</mi><mi>h</mi></msub><mrow><mo>∑</mo><msub><mi>A</mi><mi>h</mi></msub></mrow></mfrac></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}
    \label{PropArea}
    \begin{split}
    W_h = \frac{A_h}{\sum{A_h}}
\end{split}
\end{equation}</annotation></semantics></math></p>
<p>After counting the number of tows and calculating the relative weight
of each strata, the resulting <code>prepData</code> is then passed to
the <code>strat_mean</code> function.</p>
</div>
<div class="section level2">
<h2 id="strat_mean">
<code>strat_mean</code><a class="anchor" aria-label="anchor" href="#strat_mean"></a>
</h2>
<p>Once the data has been prepared using <code>strat_prep</code> the
real calculations are carried out in the function
<code>strat_mean</code>. This function will remove duplicate catch
records that may be present due to length data, merge sexed species (or
leave separate if specified), calculate the total number of stations for
the year, subset the species list if desired, and calculate the
stratified mean biomass and adundance along with the associated
variance.</p>
<p>The first few actions are straightforward. Length data is removed to
ensure each catch is accounted for once.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Remove length data if present</span></span>
<span>  <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setkey.html" class="external-link">setkey</a></span><span class="op">(</span><span class="va">stratmeanData</span>, <span class="va">CRUISE6</span>, <span class="va">STRATUM</span>, <span class="va">STATION</span>, <span class="va">SVSPP</span>, <span class="va">CATCHSEX</span><span class="op">)</span></span>
<span>  <span class="va">stratmeanData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">stratmeanData</span>, by <span class="op">=</span> <span class="fu">key</span><span class="op">(</span><span class="va">stratmeanData</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">stratmeanData</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'LENGTH'</span>, <span class="st">'NUMLEN'</span><span class="op">)</span> <span class="op">:=</span> <span class="cn">NULL</span><span class="op">]</span></span></code></pre></div>
<p>Similarly, catch from sexed species such as spiny dogfish are merged
or kept separate. The default is to merge them but a user may specify to
keep them separate by setting the <code>mergesexFlag</code> to
<em>FALSE</em>. Sexed species are kept separate by changing their group
designation to a concatenation of their group name and catch sex.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Merge sex or keep separate</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">mergesexFlag</span> <span class="op">==</span> <span class="cn">F</span><span class="op">)</span> <span class="va">stratmeanData</span><span class="op">[</span>, <span class="va">group</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">group</span>, <span class="va">CATCHSEX</span>, sep <span class="op">=</span> <span class="st">''</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span>  <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setkey.html" class="external-link">setkey</a></span><span class="op">(</span><span class="va">stratmeanData</span>, <span class="va">CRUISE6</span>, <span class="va">strat</span>, <span class="va">STATION</span>, <span class="va">group</span><span class="op">)</span></span>
<span>  <span class="va">stratmeanData</span><span class="op">[</span>, <span class="va">BIOMASS</span>   <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">BIOMASS</span><span class="op">)</span>,   by <span class="op">=</span> <span class="fu">key</span><span class="op">(</span><span class="va">stratmeanData</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">stratmeanData</span><span class="op">[</span>, <span class="va">ABUNDANCE</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">ABUNDANCE</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu">key</span><span class="op">(</span><span class="va">stratmeanData</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">stratmeanData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">stratmeanData</span>, by <span class="op">=</span> <span class="fu">key</span><span class="op">(</span><span class="va">stratmeanData</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The total number of tows per year is the sum of <code>ntows</code>
for all of the strata sampled for a given year.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Calculate total number of stations per year</span></span>
<span>  <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setkey.html" class="external-link">setkey</a></span><span class="op">(</span><span class="va">stratmeanData</span>, <span class="va">strat</span>, <span class="va">YEAR</span><span class="op">)</span></span>
<span>  <span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">stratmeanData</span>, by <span class="op">=</span> <span class="fu">key</span><span class="op">(</span><span class="va">stratmeanData</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">N</span> <span class="op">&lt;-</span> <span class="va">N</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">ntows</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">'YEAR'</span><span class="op">]</span></span>
<span>  <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setattr.html" class="external-link">setnames</a></span><span class="op">(</span><span class="va">N</span>, <span class="st">'V1'</span>, <span class="st">'N'</span><span class="op">)</span></span></code></pre></div>
<p>Species or group list can be subsetted using the
<code>filterByGroup</code> argument.</p>
</div>
<div class="section level2">
<h2 id="stratified-mean-and-variance-calculations">Stratified mean and variance calculations<a class="anchor" aria-label="anchor" href="#stratified-mean-and-variance-calculations"></a>
</h2>
<p>Finally, the stratified mean biomass is calculated as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>B</mi><mo accent="true">‾</mo></mover><mo>=</mo><munderover><mo>∑</mo><mrow><mi>h</mi><mo>=</mo><mn>1</mn></mrow><mi>L</mi></munderover><mrow><msub><mi>W</mi><mi>h</mi></msub><mover><msub><mi>B</mi><mi>h</mi></msub><mo accent="true">‾</mo></mover></mrow></mrow><annotation encoding="application/x-tex">\begin{equation}
    \label{Stratifed}
    \bar{B} = \sum_{h = 1}^{L}{W_h\bar{B_h}}
\end{equation}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>B</mi><mo accent="true">‾</mo></mover><annotation encoding="application/x-tex">\bar{B}</annotation></semantics></math>
is the stratified mean biomass,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>W</mi><mi>h</mi></msub><annotation encoding="application/x-tex">W_h</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><msub><mi>B</mi><mi>h</mi></msub><mo accent="true">‾</mo></mover><annotation encoding="application/x-tex">\bar{B_h}</annotation></semantics></math>
the relative weight and mean biomass from stratum
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>L</mi><annotation encoding="application/x-tex">L</annotation></semantics></math>
the total number of strata.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><msub><mi>B</mi><mi>h</mi></msub><mo accent="true">‾</mo></mover><annotation encoding="application/x-tex">\bar{B_h}</annotation></semantics></math>
is calculated as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><msub><mi>B</mi><mi>h</mi></msub><mo accent="true">‾</mo></mover><mo>=</mo><mfrac><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>B</mi><mi>i</mi></msub></mrow><msub><mi>n</mi><mi>h</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">\begin{equation}
    \label{mean biomass}
    \bar{B_h} = \frac{\sum_{i = 1}^n{B_i}}{n_h}
\end{equation}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>B</mi><mi>i</mi></msub><annotation encoding="application/x-tex">B_i</annotation></semantics></math>
is the biomass at station
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>h</mi></msub><annotation encoding="application/x-tex">n_h</annotation></semantics></math>
the number of stations in stratum
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>.</p>
<p>Additionally, variance is calculated as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>s</mi><mover><mi>B</mi><mo accent="true">‾</mo></mover><mn>2</mn></msubsup><mo>=</mo><munderover><mo>∑</mo><mrow><mi>h</mi><mo>=</mo><mn>1</mn></mrow><mi>L</mi></munderover><mfrac><mrow><msubsup><mi>W</mi><mi>h</mi><mn>2</mn></msubsup><msubsup><mi>s</mi><mi>h</mi><mn>2</mn></msubsup></mrow><msub><mi>n</mi><mi>h</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">\begin{equation}
    \label{stratified variance}
    s_{\bar{B}}^2 = \sum_{h = 1}^L{\frac{W_{h}^{2} s_{h}^{2}}{n_{h}}}
\end{equation}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>s</mi><mover><mi>B</mi><mo accent="true">‾</mo></mover><mn>2</mn></msubsup><annotation encoding="application/x-tex">s_{\bar{B}}^2</annotation></semantics></math>
is the variance of the stratified mean biomass and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>s</mi><mi>h</mi><mn>2</mn></msubsup><annotation encoding="application/x-tex">s_h^2</annotation></semantics></math>
the variance of the mean for stratum
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>s</mi><mi>h</mi><mn>2</mn></msubsup><annotation encoding="application/x-tex">s_h^2</annotation></semantics></math>
is calculated as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>s</mi><mi>h</mi><mn>2</mn></msubsup><mo>=</mo><mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>B</mi><mi>i</mi></msub><mo>−</mo><mover><msub><mi>B</mi><mi>h</mi></msub><mo accent="true">‾</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mrow><msub><mi>n</mi><mi>h</mi></msub><mo>−</mo><mn>1</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">\begin{equation}
    \label{strata variance}
    s_h^2 = \frac{{(B_i - \bar{B_h})}^2}{n_h - 1}
\end{equation}</annotation></semantics></math></p>
<p>If the <code>poststratFlag</code> was set to <em>TRUE</em> because a
different stratification was used rather than the survey design, the
variance calculation becomes:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>s</mi><mover><mi>B</mi><mo accent="true">‾</mo></mover><mn>2</mn></msubsup><mo>=</mo><mfrac><mrow><munderover><mo>∑</mo><mrow><mi>h</mi><mo>=</mo><mn>1</mn></mrow><mi>L</mi></munderover><mrow><msubsup><mi>s</mi><mi>h</mi><mn>2</mn></msubsup><msub><mi>W</mi><mi>h</mi></msub></mrow></mrow><mi>N</mi></mfrac><mo>+</mo><munderover><mo>∑</mo><mrow><mi>h</mi><mo>=</mo><mn>1</mn></mrow><mi>L</mi></munderover><mfrac><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><msub><mi>W</mi><mi>h</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><msubsup><mi>s</mi><mi>h</mi><mn>2</mn></msubsup></mrow><msup><mi>N</mi><mn>2</mn></msup></mfrac></mrow><annotation encoding="application/x-tex">\begin{equation}
    \label{penalty variance}
    s_{\bar{B}}^2 = \frac{\sum_{h = 1}^L{s_{h}^{2} W_h}}{N} + 
                    \sum_{h = 1}^L{\frac{(1 - W_h)s_h^2}{N^2}}
\end{equation}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>
is the total number of stations for the year.</p>
<p>The final calculation for the <code>calc_stratified_mean</code>
function is the standard error of the mean which is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mover><mi>B</mi><mo accent="true">‾</mo></mover></msub><mo>=</mo><msqrt><msubsup><mi>s</mi><mover><mi>B</mi><mo accent="true">‾</mo></mover><mn>2</mn></msubsup></msqrt></mrow><annotation encoding="application/x-tex">\begin{equation}
    \label{standard error}
    s_{\bar{B}} = \sqrt{s_{\bar{B}}^2}
\end{equation}</annotation></semantics></math></p>
<p>Similar calculations are carried out for abundance with numbers
replacing biomass in the equations above.</p>
</div>
<div class="section level2">
<h2 id="tidy-data">Tidy data<a class="anchor" aria-label="anchor" href="#tidy-data"></a>
</h2>
<p>The default output from the <code>calc_stratified_mean</code>
function is a wide table with a row for every year/group combination.
You can elect a tidy format (long) instead by specifying the argument
<code>tidy</code> = <em>TRUE</em>. This will melt the table down so that
each year/group combo will now have a seperate row for stratified mean
biomass, stratified mean abundance, variance of the stratified mean
biomass, and variance of the stratified mean abundance. The tidy data
will also append a units column to the data set. The units for the
stratified mean biomass is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mi>g</mi><mi>t</mi><mi>o</mi><msup><mi>w</mi><mo>−</mo></msup><mn>1</mn></mrow><annotation encoding="application/x-tex">kg tow^-1</annotation></semantics></math>
while the stratified mean abundance is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>t</mi><mi>o</mi><msup><mi>w</mi><mo>−</mo></msup><mn>1</mn></mrow><annotation encoding="application/x-tex">numbers tow^-1</annotation></semantics></math>.
Note that the tidy data set does not include the standard errors.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sean Lucey, Andy Beet.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
