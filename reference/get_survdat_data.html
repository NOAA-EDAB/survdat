<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Extracts Survey data from Database — get_survdat_data • survdat</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Extracts Survey data from Database — get_survdat_data"><meta name="description" content="Connects to svdbs and pulls data from MSTR_CRUISE, UNION_FSCS_SVCAT,
UNION_FSCS_SVLEN, UNION_FSCS_SVSTA, UNION_FSCS_SVBIO"><meta property="og:description" content="Connects to svdbs and pulls data from MSTR_CRUISE, UNION_FSCS_SVCAT,
UNION_FSCS_SVLEN, UNION_FSCS_SVSTA, UNION_FSCS_SVBIO"><meta property="og:image" content="https://noaa-edab.github.io/survdat/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">survdat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/survdat.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><h6 class="dropdown-header" data-toc-skip>Introduction</h6></li>
    <li><a class="dropdown-item" href="../articles/surveyDesign.html">Survey design</a></li>
    <li><a class="dropdown-item" href="../articles/pullingData.html">Pulling the data</a></li>
    <li><a class="dropdown-item" href="../articles/lookupTables.html">Lookup tables</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Methodology</h6></li>
    <li><a class="dropdown-item" href="../articles/methodology.html">Estimating Biomass</a></li>
    <li><a class="dropdown-item" href="../articles/calc_strat_mean.html">Estimating stratified mean</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NOAA-EDAB/survdat/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Extracts Survey data from Database</h1>
      <small class="dont-index">Source: <a href="https://github.com/NOAA-EDAB/survdat/blob/master/R/get_survdat_data.R" class="external-link"><code>R/get_survdat_data.R</code></a></small>
      <div class="d-none name"><code>get_survdat_data.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Connects to svdbs and pulls data from MSTR_CRUISE, UNION_FSCS_SVCAT,
UNION_FSCS_SVLEN, UNION_FSCS_SVSTA, UNION_FSCS_SVBIO</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">get_survdat_data</span><span class="op">(</span></span>
<span>  <span class="va">channel</span>,</span>
<span>  filterByYear <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  all.season <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  shg.check <span class="op">=</span> <span class="cn">T</span>,</span>
<span>  conversion.factor <span class="op">=</span> <span class="cn">T</span>,</span>
<span>  use.SAD <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  getBio <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  getLengths <span class="op">=</span> <span class="cn">T</span>,</span>
<span>  getWeightLength <span class="op">=</span> <span class="cn">F</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-channel">channel<a class="anchor" aria-label="anchor" href="#arg-channel"></a></dt>
<dd><p>an Object inherited from <a href="https://dbi.r-dbi.org/reference/DBIConnection-class.html" class="external-link">DBIConnection-class</a>.
This object is used to communicate with the database engine.
 (see <code>connect_to_database</code>)</p></dd>


<dt id="arg-filterbyyear">filterByYear<a class="anchor" aria-label="anchor" href="#arg-filterbyyear"></a></dt>
<dd><p>Numeric vector. Subset of years from which to pull data.
If not specified then all years are pulled. (Default = NA)</p></dd>


<dt id="arg-all-season">all.season<a class="anchor" aria-label="anchor" href="#arg-all-season"></a></dt>
<dd><p>Boolean. Spring and Fall only (F) otherwise T. (Default = F)</p></dd>


<dt id="arg-shg-check">shg.check<a class="anchor" aria-label="anchor" href="#arg-shg-check"></a></dt>
<dd><p>Boolean. use only SHG &lt;=136 or TOGA &lt;= 1324 (&gt;2008). (Default = T)</p></dd>


<dt id="arg-conversion-factor">conversion.factor<a class="anchor" aria-label="anchor" href="#arg-conversion-factor"></a></dt>
<dd><p>Boolean. Whether to apply conversion factors to the data pull, (Default = T)</p></dd>


<dt id="arg-use-sad">use.SAD<a class="anchor" aria-label="anchor" href="#arg-use-sad"></a></dt>
<dd><p>Boolean. Use Survey Analysis Database (SAD) for assessed species. (Default = F)</p></dd>


<dt id="arg-getbio">getBio<a class="anchor" aria-label="anchor" href="#arg-getbio"></a></dt>
<dd><p>Boolean. Include biology data for each fish weight, sex,
stomach weight, stomach volume, age, maturity</p></dd>


<dt id="arg-getlengths">getLengths<a class="anchor" aria-label="anchor" href="#arg-getlengths"></a></dt>
<dd><p>Boolean. Include length data which includes the length in
cm and the number at length. (Default = T)</p></dd>


<dt id="arg-getweightlength">getWeightLength<a class="anchor" aria-label="anchor" href="#arg-getweightlength"></a></dt>
<dd><p>Boolean. Include the weight at length by applying length
weight coefficients from SVDBS. (Default = F)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing a Data frame (data.table) (n x 21),
a list of SQL queries used to pull the data, the date of the pull,
and the call expression. Each row of the data.table represents the number
at length of a species on a specific tow along with physical attributes of the tow.</p>
<p>The data frame (Descriptions taken from NEFSC Data dictionary)</p>
<dl><dt>CRUISE6</dt>
<dd><p>Code uniquely identifying cruise. The first four digits indicate the year and the last two digit uniquely identify the cruise within the year. The 5th byte signifies cruises other than groundfish: Shrimp survey = 7 (i.e. 201470), State of Massachusetts survey = 9 (i.e. 201491), Food habits = 5 (i.e.199554)</p></dd>

<dt>STATION</dt>
<dd><p>Unique sequential order in which stations have been completed. Hangups and short tows each receive a non-repeated consecutive number.</p></dd>

<dt>STRATUM</dt>
<dd><p>A predefined area where a net dredge, or other piece of gear was deployed. Code consists of 2 parts: Stratum group code number (2 bytes) and stratum number (3 bytes). Stratum group refers to if area fished is inshore or offshore North or South of Cape Hatteras or the type of cruise (shellfish, State of MA, offshore deepwater). The stratum number (third and fourth digits of code) refers to area defined by depth zone. See SVDBS.SVMSTRATA. The fifth digit of the code increases the length of the stratum number for revised strata after the Hague Line was established. Stratum group code: 01 = Trawl, offshore north of Hatteras; 02 = BIOM; 03 = Trawl, inshore north of Hatteras; 04 = Shrimp; 05 = Scotian shelf; 06 = Shellfish; 07 = Trawl, inshore south of Hatteras; 08 = Trawl, Offshore south of Hatteras; 09 = MA DMF; 99 = Offshore deepwater (outside the stratified area). A change in Bottom Trawl Stratum for the Gulf of Maine-Bay of Fundy has been in effect since Spring 1987, and may be summarized as follows: Previous strata: 01350; Present strata: 01351, 01352.</p></dd>

<dt>TOW</dt>
<dd><p>Sequential number representing order in which station was selected within a stratum.</p></dd>

<dt>SVSPP</dt>
<dd><p>A standard code which represents a species caught in a trawl or dredge. Refer to the SVDBS.SVSPECIES_LIST</p></dd>

<dt>CATCHSEX</dt>
<dd><p>Code used to identify species that are sexed at the catch level. See SVDBS.SEX_CODES</p></dd>

<dt>SVVESSEL</dt>
<dd><p>Standard two character code for a survey vessel. Refer to SVDBS.SV_VESSEL</p></dd>

<dt>YEAR</dt>
<dd><p>Year in which cruise was conducted.</p></dd>

<dt>SEASON</dt>
<dd><p>Season of the year in which cruise was conducted.</p></dd>

<dt>LAT</dt>
<dd><p>Beginning latitude of tow in decimal degrees.(DECDEG_BEGLAT)</p></dd>

<dt>LON</dt>
<dd><p>Beginning longitude of tow in decimal degrees.(DECDEG_BEGLON)</p></dd>

<dt>EST_TOWDATE</dt>
<dd><p>Date and time represented by Eastern Standard Time (EST) for the start of a tow or deployment.(BEGIN_EST_TOWDATE)</p></dd>

<dt>DEPTH</dt>
<dd><p>A four digit number recording the average depth, to the nearest meter, during a survey gear deployment.(AVGDEPTH)</p></dd>

<dt>SURFTEMP</dt>
<dd><p>Surface temperature of water (degrees Celcius).</p></dd>

<dt>SURFSALIN</dt>
<dd><p>Salinity at water surface in practical salinity units (PSU).</p></dd>

<dt>BOTTEMP</dt>
<dd><p>Bottom temperature (degrees Celsius).</p></dd>

<dt>BOTSALIN</dt>
<dd><p>Bottom salinity in Practical Salinity Units (PSU).</p></dd>

<dt>ABUNDANCE</dt>
<dd><p>Expanded number of individuals of a species caught at a given station.(EXPCATCHNUM)</p></dd>

<dt>BIOMASS</dt>
<dd><p>Expanded catch weight of a species caught at a given station. (EXPCATCHWT)</p></dd>


</dl><p>Additional Columns if getLengths = T (UNION_FSCS_SVLEN)</p>
<dl><dt>LENGTH</dt>
<dd><p>Measured length of species in centimeters (cm). Measure method differs by species.</p></dd>

<dt>NUMLEN</dt>
<dd><p>Expanded number of specimens at a given length.(EXPNUMLEN)</p></dd>


</dl><p>Additional Columns if getWeightLength = T</p>
<dl><dt>PREDWT</dt>
<dd><p>Predicted weight given length based on length-weight coefficients.</p></dd>

<dt>WGTLEN</dt>
<dd><p>Predicted total weight given number of fish observed at given length</p></dd>


</dl><p>Additional columns if bio = T (UNION_FSCS_SVBIO)</p>
<dl><dt>INDID</dt>
<dd><p>A unique identifier for each fish sampled.</p></dd>

<dt>INDWT</dt>
<dd><p>Individual weight (KG) of species being sampled.</p></dd>

<dt>SEX</dt>
<dd><p>Code indicating sex of fish or invertebrate species. See SVDBS.FSCS_SEX_CODES if using fscs data and SVDBS.SEX_CODES if using non FSCS data. Codes 0, 1, 2 and 4 are the only valid codes in fscs tables.</p></dd>

<dt>MATURITY</dt>
<dd><p>Stage of maturation of the fish being sampled. See SVDBS.FSCS_MATURITY_CODES</p></dd>

<dt>AGE</dt>
<dd><p>Age of specimen in years.</p></dd>

<dt>STOM_VOLUME</dt>
<dd><p>Volume of the stomach contents of the fish sampled, measured to the nearest tenth of a cubic centimeter (cc).</p></dd>

<dt>STOM_WGT</dt>
<dd><p>Stomach weight of an individual fish in grams.</p></dd>


</dl><p>The list of sql statements:</p>
<dl><dt>cruise</dt>
<dd><p>Select unique list of cruises. Table = MSTR_CRUISE</p></dd>

<dt>station</dt>
<dd><p>Select unique set of stations from result of <code>cruise</code>. Table = UNION_FSCS_SVSTA</p></dd>

<dt>catch</dt>
<dd><p>Select species abundance and biomass data from result of <code>station</code>. Table = UNION_FSCS_SVCAT</p></dd>

<dt>length</dt>
<dd><p>Select Lengths of species found in <code>catch</code>. Table = UNION_FSCS_SVLEN</p></dd>

<dt>sad</dt>
<dd><p>Select ????? from Survey Analysis Database. Table = STOCKEFF.I_SV_MERGED_CATCH_CALIB_O</p></dd>

<dt>conversions</dt>
<dd><p>Select conversion factors. Table = SURVAN_CONVERSION_FACTORS</p></dd>

<dt>bio</dt>
<dd><p>Select bio stats. Table = UNION_FSCS_SVBIO</p></dd>


</dl><p>The date:</p>
<dl><dt>pullDate</dt>
<dd><p>The date the data was pulled from the database</p></dd>


</dl><p>The expression:</p>
<dl><dt>functionCall</dt>
<dd><p>The call used to create the data pull</p></dd>


</dl><p>The version:</p>
<dl><dt>version</dt>
<dd><p>The version of survdat used to pull the data</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other survdat:
<code><a href="calc_stratified_mean.html">calc_stratified_mean</a>()</code>,
<code><a href="calc_swept_area.html">calc_swept_area</a>()</code>,
<code><a href="get_area.html">get_area</a>()</code>,
<code><a href="get_survdat_clam_data.html">get_survdat_clam_data</a>()</code>,
<code><a href="get_survdat_scallop_data.html">get_survdat_scallop_data</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># First create a connection object to the database</span></span></span>
<span class="r-in"><span><span class="va">channel</span> <span class="op">&lt;-</span> <span class="fu">dbutils</span><span class="fu">::</span><span class="fu">connect_to_database</span><span class="op">(</span><span class="st">"serverName"</span>,<span class="st">"userName"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># pull survey data, applies conversion factors (Door, net, vessel) and join with</span></span></span>
<span class="r-in"><span><span class="co"># biological data to return individual sex, age, maturity, stomach data</span></span></span>
<span class="r-in"><span><span class="fu">get_survdat_data</span><span class="op">(</span><span class="va">channel</span>,conversion.factor <span class="op">=</span> <span class="cn">T</span>, bio<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Same data pull without individual biological data</span></span></span>
<span class="r-in"><span><span class="fu">get_survdat_data</span><span class="op">(</span><span class="va">channel</span>,conversion.factor <span class="op">=</span> <span class="cn">T</span>, bio<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sean Lucey, Andy Beet.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

